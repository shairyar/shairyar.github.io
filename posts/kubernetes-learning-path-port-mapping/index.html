<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Kubernetes Learning Path: Understanding Port Mapping in k3d" /><meta property="og:locale" content="en" /><meta name="description" content="Kubernetes Learning Path: Understanding Port Mapping in k3d" /><meta property="og:description" content="Kubernetes Learning Path: Understanding Port Mapping in k3d" /><link rel="canonical" href="https://shairyar.github.io/posts/kubernetes-learning-path-port-mapping/" /><meta property="og:url" content="https://shairyar.github.io/posts/kubernetes-learning-path-port-mapping/" /><meta property="og:site_name" content="Shairyar Baig" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-10-23T10:00:00+05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Kubernetes Learning Path: Understanding Port Mapping in k3d" /><meta name="twitter:site" content="@iamshairyar" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-10-23T10:00:00+05:00","datePublished":"2025-10-23T10:00:00+05:00","description":"Kubernetes Learning Path: Understanding Port Mapping in k3d","headline":"Kubernetes Learning Path: Understanding Port Mapping in k3d","mainEntityOfPage":{"@type":"WebPage","@id":"https://shairyar.github.io/posts/kubernetes-learning-path-port-mapping/"},"url":"https://shairyar.github.io/posts/kubernetes-learning-path-port-mapping/"}</script><title>Kubernetes Learning Path: Understanding Port Mapping in k3d | Shairyar Baig</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Shairyar Baig"><meta name="application-name" content="Shairyar Baig"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-3MSE8F2TRT"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-3MSE8F2TRT'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://pbs.twimg.com/profile_images/1531277756490825728/myc7uFj__400x400.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Shairyar Baig</a><p class="site-subtitle fst-italic mb-0">tinkering with stuff</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/shairyar" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/iamshairyar" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['shairyarbaig','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Kubernetes Learning Path: Understanding Port Mapping in k3d</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Kubernetes Learning Path: Understanding Port Mapping in k3d</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1761195600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 23, 2025 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/iamshairyar">Shairyar Baig</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="3310 words" > <em>18 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Kubernetes Learning Path: Understanding Port Mapping in k3d</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Kubernetes Learning Path: Understanding Port Mapping in k3d</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h1 id="kubernetes-learning-path-understanding-port-mapping-in-k3d">Kubernetes Learning Path: Understanding Port Mapping in k3d</h1><p>In the <a href="/posts/kubernetes-learning-path-namespaces/">previous posts</a>, we’ve been using <code class="language-plaintext highlighter-rouge">kubectl port-forward</code> to access our applications. That works fine for testing, but it’s manual and you can only forward one service at a time. What if you want to run multiple services and access them all through different ports on your localhost?</p><p>When I first started with k3d, I thought I could just create a cluster, deploy some apps, and hit localhost:8080 or localhost:3000 to see them. Nope. Services running inside the cluster aren’t automatically accessible from your host machine. You need to set up port mapping when you create the cluster.</p><p>Here’s where it gets tricky—I spent way too long trying to map multiple services using LoadBalancer, only to get 404 errors. It took me a while to figure out that LoadBalancer in k3d requires Ingress configuration to actually route traffic. Once I discovered NodePort as a simpler alternative for local development, everything clicked.</p><p>In this post, I’ll show you what I learned about port mapping in k3d, including the LoadBalancer mistake I made and the NodePort solution that actually worked.</p><h2 id="the-problem-services-are-inside-the-cluster"><span class="me-2">The Problem: Services Are Inside the Cluster</span><a href="#the-problem-services-are-inside-the-cluster" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Your k3d cluster runs inside Docker containers. When you create a service, it gets an IP address inside the Docker network, not on your host machine. So when you try to access localhost:8080, nothing happens—there’s no service listening there.</p><p>Think of your cluster like a virtual network inside your computer. To access services in that network, you need a way to route traffic from your localhost into the cluster—that’s what port mapping does.</p><h2 id="understanding-port-mapping"><span class="me-2">Understanding Port Mapping</span><a href="#understanding-port-mapping" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Port mapping tells k3d: “when traffic hits localhost:8080 on my machine, forward it to a specific port inside the cluster.” You set this up when you create the cluster.</p><p>The basic syntax looks like this:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nt">--port</span> <span class="s2">"8080:30080@server:0"</span>
</pre></table></code></div></div><p>This breaks down to:</p><ul><li><code class="language-plaintext highlighter-rouge">8080</code> - Port on your localhost<li><code class="language-plaintext highlighter-rouge">30080</code> - Port inside the cluster<li><code class="language-plaintext highlighter-rouge">@server:0</code> - Target the first server node</ul><p>But here’s where it gets confusing—what port do you map to? LoadBalancer port 80? A NodePort? I made the mistake of using LoadBalancer, and that didn’t work the way I expected.</p><h2 id="my-first-attempt-using-loadbalancer"><span class="me-2">My First Attempt: Using LoadBalancer</span><a href="#my-first-attempt-using-loadbalancer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I thought I could create a cluster with multiple LoadBalancer port mappings, like this:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>k3d cluster create learning <span class="se">\</span>
  <span class="nt">--port</span> <span class="s2">"8080:80@loadbalancer"</span> <span class="se">\</span>
  <span class="nt">--port</span> <span class="s2">"3000:80@loadbalancer"</span>
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>INFO[0000] Prep: Network                                
INFO[0000] Created network 'k3d-learning'               
INFO[0000] Created image volume k3d-learning-images     
INFO[0001] Creating node 'k3d-learning-server-0'        
INFO[0002] Creating LoadBalancer 'k3d-learning-serverlb'
INFO[0003] Cluster 'learning' created successfully!
</pre></table></code></div></div><p>Then I deployed two different nginx applications with LoadBalancer services, making sure to give them custom content so I could tell them apart. Let me show you exactly what I did so you can see where it goes wrong.</p><p>First, create ConfigMaps with different content for each app:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>kubectl create configmap app1-html <span class="nt">--from-literal</span><span class="o">=</span>index.html<span class="o">=</span><span class="s1">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;APP 1&lt;/h1&gt;&lt;p&gt;This should only appear on port 8080&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span>
kubectl create configmap app2-html <span class="nt">--from-literal</span><span class="o">=</span>index.html<span class="o">=</span><span class="s1">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;APP 2&lt;/h1&gt;&lt;p&gt;This should only appear on port 3000&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span>
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>configmap/app1-html created
configmap/app2-html created
</pre></table></code></div></div><p>Create the first deployment and service. Create a file called <code class="language-plaintext highlighter-rouge">app1-deployment.yaml</code>:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">app1</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">app1</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">app1</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>                <span class="c1"># References the volume defined below</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>  <span class="c1"># Where nginx looks for HTML files</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>                  <span class="c1"># Volume name referenced above</span>
        <span class="na">configMap</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">app1-html</span>           <span class="c1"># References the ConfigMap we created</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">app1-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>              <span class="c1"># Using LoadBalancer type</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">app1</span>                     <span class="c1"># Routes traffic to pods with label app=app1</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>                      <span class="c1"># Port the service listens on inside the cluster</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">80</span>                <span class="c1"># Port on the pod containers</span>
</pre></table></code></div></div><p>Apply it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> app1-deployment.yaml
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>deployment.apps/app1 created
service/app1-service created
</pre></table></code></div></div><blockquote class="prompt-tip"><p><strong>How ConfigMap keys become files:</strong> When you mount a ConfigMap as a volume, Kubernetes automatically converts each key-value pair into a file. The ConfigMap key (<code class="language-plaintext highlighter-rouge">index.html</code>) becomes the filename, and the value (the HTML content) becomes the file contents. So when we mount this ConfigMap at <code class="language-plaintext highlighter-rouge">/usr/share/nginx/html</code>, Kubernetes will create <code class="language-plaintext highlighter-rouge">/usr/share/nginx/html/index.html</code> inside the container with our HTML content. This is why nginx can find and serve the file—it’s automatically created in the directory where nginx looks for HTML files.</p></blockquote><p>Create the second deployment and service. Create <code class="language-plaintext highlighter-rouge">app2-deployment.yaml</code>:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">app2</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">app2</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">app2</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>                <span class="c1"># References the volume defined below</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>  <span class="c1"># Where nginx looks for HTML files</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>                  <span class="c1"># Volume name referenced above</span>
        <span class="na">configMap</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">app2-html</span>           <span class="c1"># References app2's ConfigMap</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">app2-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>              <span class="c1"># Using LoadBalancer type</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">app2</span>                     <span class="c1"># Routes traffic to pods with label app=app2</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>                      <span class="c1"># Port the service listens on inside the cluster</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">80</span>                <span class="c1"># Port on the pod containers</span>
</pre></table></code></div></div><p>Apply it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> app2-deployment.yaml
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>deployment.apps/app2 created
service/app2-service created
</pre></table></code></div></div><p>Check your services:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get services
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>NAME           TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
app1-service   LoadBalancer   10.43.123.45    &lt;pending&gt;     80:31234/TCP   1m
app2-service   LoadBalancer   10.43.234.56    &lt;pending&gt;     80:31567/TCP   30s
kubernetes     ClusterIP      10.43.0.1       &lt;none&gt;        443/TCP        5m
</pre></table></code></div></div><p>Both services are created! I opened my browser and tried:</p><ul><li><code class="language-plaintext highlighter-rouge">http://localhost:8080</code> - Shows “404 page not found”<li><code class="language-plaintext highlighter-rouge">http://localhost:3000</code> - Shows… “404 page not found”</ul><p>Wait, what? I’m getting 404 errors from both ports. The services are running (I can see them in <code class="language-plaintext highlighter-rouge">kubectl get services</code>), but I can’t access them. What’s going on?</p><h2 id="what-i-figured-out-about-loadbalancer-mapping"><span class="me-2">What I Figured Out About LoadBalancer Mapping</span><a href="#what-i-figured-out-about-loadbalancer-mapping" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>After some testing and digging, here’s what I learned: k3d uses Traefik as its built-in load balancer. When you map ports to <code class="language-plaintext highlighter-rouge">@loadbalancer</code>, those ports forward traffic to Traefik. But here’s the catch—<strong>Traefik needs Ingress resources to know how to route traffic to your services</strong>.</p><p>Without Ingress configuration, Traefik has no routing rules and just returns 404.</p><p><strong>“But wait, didn’t port-forward work in the previous tutorials?”</strong></p><p>Yes! And that confused me at first too. Here’s the key difference:</p><ul><li><p><strong><code class="language-plaintext highlighter-rouge">kubectl port-forward</code></strong> creates a direct tunnel from your machine to the pod through the Kubernetes API server. It completely bypasses all cluster networking, load balancers, and ingress controllers. It’s purely a development tool that works immediately with zero configuration.</p><li><p><strong>LoadBalancer with port mapping</strong> routes traffic through k3d’s Traefik load balancer, which expects proper Ingress resources with routing rules (hostnames, paths, etc.) to know which service should handle the traffic.</p></ul><p>So to make LoadBalancer work in k3d, you’d need to:</p><ol><li>Create Ingress resources for each service<li>Configure host-based routing (like <code class="language-plaintext highlighter-rouge">app1.localhost</code> and <code class="language-plaintext highlighter-rouge">app2.localhost</code>)<li>Set up DNS or host file entries<li>Possibly configure TLS certificates</ol><p>For local development, that seemed like way too much work just to access my apps. I needed something simpler, and that’s when I discovered NodePort.</p><p>(We’ll explore Ingress and Traefik in a future post—they’re powerful for production setups, but overkill for basic local development.)</p><h2 id="what-worked-for-me-using-nodeport"><span class="me-2">What Worked for Me: Using NodePort</span><a href="#what-worked-for-me-using-nodeport" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>What ended up working was using NodePort instead of LoadBalancer, and mapping my localhost ports directly to specific NodePorts. This way, each localhost port goes straight to a specific service without going through a shared load balancer.</p><p>First, let’s clean up the old cluster:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>k3d cluster delete learning
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>INFO[0000] Deleting cluster 'learning'                  
INFO[0001] Cluster 'learning' deleted successfully!
</pre></table></code></div></div><p>Now create a new cluster with NodePort mappings:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>k3d cluster create learning <span class="se">\</span>
  <span class="nt">--port</span> <span class="s2">"8080:30080@server:0"</span> <span class="se">\</span>
  <span class="nt">--port</span> <span class="s2">"3000:30081@server:0"</span>
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>INFO[0000] Prep: Network                                
INFO[0000] Created network 'k3d-learning'               
INFO[0000] Created image volume k3d-learning-images     
INFO[0001] Creating node 'k3d-learning-server-0'        
INFO[0002] Creating LoadBalancer 'k3d-learning-serverlb'
INFO[0003] Cluster 'learning' created successfully!
</pre></table></code></div></div><p>The port mapping syntax means:</p><ul><li>Traffic to localhost:8080 → forwards to port 30080 inside the cluster<li>Traffic to localhost:3000 → forwards to port 30081 inside the cluster<li><code class="language-plaintext highlighter-rouge">@server:0</code> targets the first server node (the control plane)</ul><p>NodePort services listen on ports between 30000-32767 by default, so we’re using 30080 and 30081.</p><h2 id="deploy-apps-with-nodeport-services"><span class="me-2">Deploy Apps with NodePort Services</span><a href="#deploy-apps-with-nodeport-services" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now let’s deploy two apps with NodePort services that use specific ports. We’ll also customize the content so we can tell them apart.</p><h3 id="step-1-create-app-1-with-custom-content"><span class="me-2">Step 1: Create App 1 with Custom Content</span><a href="#step-1-create-app-1-with-custom-content" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>First, create a ConfigMap with custom HTML for app1:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl create configmap app1-html <span class="nt">--from-literal</span><span class="o">=</span>index.html<span class="o">=</span><span class="s1">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;This is App 1 on localhost:8080&lt;/h1&gt;&lt;p&gt;NodePort: 30080&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span>
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>configmap/app1-html created
</pre></table></code></div></div><p>Create a file called <code class="language-plaintext highlighter-rouge">app1-nodeport.yaml</code>:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">app1</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">app1</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">app1</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>              <span class="c1"># References the volume defined below</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>  <span class="c1"># Where nginx looks for HTML files</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>                <span class="c1"># Volume name referenced above</span>
        <span class="na">configMap</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">app1-html</span>         <span class="c1"># References the ConfigMap we created</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">app1-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>                  <span class="c1"># Using NodePort instead of LoadBalancer</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">app1</span>                     <span class="c1"># Routes traffic to pods with label app=app1</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>                      <span class="c1"># Port the service listens on inside the cluster</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">80</span>                <span class="c1"># Port on the pod containers</span>
    <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30080</span>               <span class="c1"># Specific NodePort (must match cluster port mapping)</span>
</pre></table></code></div></div><p>The key parts:</p><ul><li>The ConfigMap contains our custom HTML<li>The volume makes the ConfigMap available to the pod<li>The volumeMount puts that HTML where nginx expects to find it (<code class="language-plaintext highlighter-rouge">/usr/share/nginx/html</code>)<li>The NodePort is set to 30080, which matches our cluster port mapping</ul><p>Apply it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> app1-nodeport.yaml
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>deployment.apps/app1 created
service/app1-service created
</pre></table></code></div></div><h3 id="step-2-create-app-2-with-different-content"><span class="me-2">Step 2: Create App 2 with Different Content</span><a href="#step-2-create-app-2-with-different-content" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Create a ConfigMap for app2:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl create configmap app2-html <span class="nt">--from-literal</span><span class="o">=</span>index.html<span class="o">=</span><span class="s1">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;This is App 2 on localhost:3000&lt;/h1&gt;&lt;p&gt;NodePort: 30081&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span>
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>configmap/app2-html created
</pre></table></code></div></div><p>Create <code class="language-plaintext highlighter-rouge">app2-nodeport.yaml</code>:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">app2</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">app2</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">app2</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:alpine</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
        <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>              <span class="c1"># References the volume defined below</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>  <span class="c1"># Where nginx looks for HTML files</span>
      <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>                <span class="c1"># Volume name referenced above</span>
        <span class="na">configMap</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">app2-html</span>         <span class="c1"># References app2's ConfigMap</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">app2-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>                  <span class="c1"># Using NodePort instead of LoadBalancer</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">app2</span>                     <span class="c1"># Routes traffic to pods with label app=app2</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>                      <span class="c1"># Port the service listens on inside the cluster</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">80</span>                <span class="c1"># Port on the pod containers</span>
    <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30081</span>               <span class="c1"># Different NodePort for app2</span>
</pre></table></code></div></div><p>Apply it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> app2-nodeport.yaml
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>deployment.apps/app2 created
service/app2-service created
</pre></table></code></div></div><h3 id="step-3-verify-the-deployments"><span class="me-2">Step 3: Verify the Deployments</span><a href="#step-3-verify-the-deployments" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Check that everything is running:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get all
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>NAME                        READY   STATUS    RESTARTS   AGE
pod/app1-7d8c9f5b4-x9k2p    1/1     Running   0          1m
pod/app2-6n4m8r3c2-y7p5q    1/1     Running   0          45s

NAME                   TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
service/app1-service   NodePort    10.43.123.45    &lt;none&gt;        80:30080/TCP   1m
service/app2-service   NodePort    10.43.234.56    &lt;none&gt;        80:30081/TCP   45s
service/kubernetes     ClusterIP   10.43.0.1       &lt;none&gt;        443/TCP        5m

NAME                   READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/app1   1/1     1            1           1m
deployment.apps/app2   1/1     1            1           45s
</pre></table></code></div></div><p>Notice the PORT(S) column shows <code class="language-plaintext highlighter-rouge">80:30080/TCP</code> and <code class="language-plaintext highlighter-rouge">80:30081/TCP</code>—these are the specific NodePorts we configured.</p><h3 id="step-4-access-your-applications"><span class="me-2">Step 4: Access Your Applications</span><a href="#step-4-access-your-applications" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now open your browser and visit:</p><p><strong>http://localhost:8080</strong></p><p>You should see:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>This is App 1 on localhost:8080
NodePort: 30080
</pre></table></code></div></div><p><strong>http://localhost:3000</strong></p><p>You should see:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>This is App 2 on localhost:3000
NodePort: 30081
</pre></table></code></div></div><p>Perfect! Each port shows different content. The traffic flow is:</p><ol><li>Browser hits localhost:8080<li>k3d forwards to NodePort 30080 on the cluster node<li>NodePort 30080 routes to app1-service<li>Service forwards to an app1 pod<li>Pod serves the custom HTML from the ConfigMap</ol><p>And the same happens for localhost:3000 → NodePort 30081 → app2-service → app2 pod.</p><h2 id="why-i-prefer-this-approach"><span class="me-2">Why I Prefer This Approach</span><a href="#why-i-prefer-this-approach" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>For my local k3d setup, I found NodePort to be more straightforward:</p><ul><li>Each localhost port maps to a specific NodePort<li>Each NodePort routes to a specific service<li>No shared load balancer to cause confusion<li>Simple and predictable for local development</ul><p>The trade-off is that you need to plan your port mappings when creating the cluster. If you want to add a third app later, you’d need to recreate the cluster with an additional port mapping. But for local development, I found that to be a reasonable compromise.</p><h2 id="quick-experiments"><span class="me-2">Quick Experiments</span><a href="#quick-experiments" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="add-a-third-application"><span class="me-2">Add a Third Application</span><a href="#add-a-third-application" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s add one more app to see how easy it is once you understand the pattern.</p><p>First, recreate the cluster with an additional port mapping:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>k3d cluster delete learning
k3d cluster create learning <span class="se">\</span>
  <span class="nt">--port</span> <span class="s2">"8080:30080@server:0"</span> <span class="se">\</span>
  <span class="nt">--port</span> <span class="s2">"3000:30081@server:0"</span> <span class="se">\</span>
  <span class="nt">--port</span> <span class="s2">"8081:30082@server:0"</span>
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>INFO[0000] Deleting cluster 'learning'                  
INFO[0001] Cluster 'learning' deleted successfully!
INFO[0000] Prep: Network                                
INFO[0000] Created network 'k3d-learning'               
INFO[0003] Cluster 'learning' created successfully!
</pre></table></code></div></div><p>Create a ConfigMap for app3:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl create configmap app3-html <span class="nt">--from-literal</span><span class="o">=</span>index.html<span class="o">=</span><span class="s1">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;This is App 3 on localhost:8081&lt;/h1&gt;&lt;p&gt;NodePort: 30082&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span>
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>configmap/app3-html created
</pre></table></code></div></div><p>Create <code class="language-plaintext highlighter-rouge">app3-nodeport.yaml</code>:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">app3</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">app3</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">app3</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
        <span class="s">image</span><span class="err">:</span> <span class="s">nginx:alpine</span>
        <span class="s">ports</span><span class="err">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">80</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/nginx/html</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">html</span>
    <span class="na">configMap</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">app3-html</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">app3-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">app3</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">80</span>
    <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30082</span>
</pre></table></code></div></div><p>Apply it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> app3-nodeport.yaml
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>deployment.apps/app3 created
service/app3-service created
</pre></table></code></div></div><p>Redeploy app1 and app2 (since we recreated the cluster):</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>kubectl create configmap app1-html <span class="nt">--from-literal</span><span class="o">=</span>index.html<span class="o">=</span><span class="s1">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;This is App 1 on localhost:8080&lt;/h1&gt;&lt;p&gt;NodePort: 30080&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span>
kubectl create configmap app2-html <span class="nt">--from-literal</span><span class="o">=</span>index.html<span class="o">=</span><span class="s1">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;This is App 2 on localhost:3000&lt;/h1&gt;&lt;p&gt;NodePort: 30081&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span>
kubectl apply <span class="nt">-f</span> app1-nodeport.yaml
kubectl apply <span class="nt">-f</span> app2-nodeport.yaml
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>configmap/app1-html created
configmap/app2-html created
deployment.apps/app1 created
service/app1-service created
deployment.apps/app2 created
service/app2-service created
</pre></table></code></div></div><p>Now you have three apps accessible at:</p><ul><li>http://localhost:8080 (app1)<li>http://localhost:3000 (app2)<li>http://localhost:8081 (app3)</ul><h3 id="check-service-details"><span class="me-2">Check Service Details</span><a href="#check-service-details" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You can see all the NodePort mappings:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get services
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>NAME           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
app1-service   NodePort    10.43.123.45    &lt;none&gt;        80:30080/TCP   2m
app2-service   NodePort    10.43.234.56    &lt;none&gt;        80:30081/TCP   2m
app3-service   NodePort    10.43.111.22    &lt;none&gt;        80:30082/TCP   1m
kubernetes     ClusterIP   10.43.0.1       &lt;none&gt;        443/TCP        5m
</pre></table></code></div></div><p>You can see the NodePort for each service in the PORT(S) column—80:30080, 80:30081, and 80:30082.</p><h3 id="test-with-curl"><span class="me-2">Test with curl</span><a href="#test-with-curl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Instead of using a browser, you can test with curl:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl http://localhost:8080
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;html&gt;&lt;body&gt;&lt;h1&gt;This is App 1 on localhost:8080&lt;/h1&gt;&lt;p&gt;NodePort: 30080&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl http://localhost:3000
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;html&gt;&lt;body&gt;&lt;h1&gt;This is App 2 on localhost:3000&lt;/h1&gt;&lt;p&gt;NodePort: 30081&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl http://localhost:8081
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;html&gt;&lt;body&gt;&lt;h1&gt;This is App 3 on localhost:8081&lt;/h1&gt;&lt;p&gt;NodePort: 30082&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;
</pre></table></code></div></div><p>Perfect! Each port serves different content.</p><h3 id="what-happens-if-you-skip-the-port-mapping"><span class="me-2">What Happens If You Skip the Port Mapping?</span><a href="#what-happens-if-you-skip-the-port-mapping" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s see what happens if you try to access a NodePort that wasn’t mapped when creating the cluster.</p><p>Create a service with NodePort 30083 (which we didn’t map):</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>kubectl create deployment app4 <span class="nt">--image</span><span class="o">=</span>nginx:alpine
kubectl expose deployment app4 <span class="nt">--type</span><span class="o">=</span>NodePort <span class="nt">--port</span><span class="o">=</span>80 <span class="nt">--name</span><span class="o">=</span>app4-service <span class="nt">--target-port</span><span class="o">=</span>80
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>deployment.apps/app4 created
service/app4-service exposed
</pre></table></code></div></div><p>Check what NodePort it got:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get service app4-service
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>NAME           TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
app4-service   NodePort   10.43.98.77    &lt;none&gt;        80:31847/TCP   10s
</pre></table></code></div></div><p>It got assigned NodePort 31847 (a random port since we didn’t specify one). Now try to access it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl http://localhost:31847
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl: (7) Failed to connect to localhost port 31847 after 0 ms: Couldn't connect to server
</pre></table></code></div></div><p>It doesn’t work because we didn’t map that port when creating the cluster. You can only access NodePorts that you explicitly mapped during cluster creation.</p><p>This is why planning your port mappings ahead of time is important with k3d.</p><h2 id="when-to-use-loadbalancer-vs-nodeport"><span class="me-2">When to Use LoadBalancer vs NodePort</span><a href="#when-to-use-loadbalancer-vs-nodeport" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Based on what I’ve learned so far, here’s when I’d use each:</p><p><strong>I use NodePort when:</strong></p><ul><li>I’m running k3d locally for development<li>I want multiple services accessible on different localhost ports<li>I want a direct, simple mapping without extra configuration<li>I want something that works immediately without Ingress setup</ul><p><strong>I’d use LoadBalancer when:</strong></p><ul><li>I’m ready to set up Ingress resources with proper routing rules (we’ll cover this in a future post)<li>I’m deploying to a real cloud environment (AWS, GCP, Azure) where LoadBalancer actually provisions external IPs<li>I want a single entry point with host-based or path-based routing<li>I’m building a production-ready setup with proper domain names</ul><p>For my local k3d development with multiple services, NodePort with port mapping has been working really well. It’s direct, predictable, and doesn’t require any additional configuration beyond the cluster creation. But I’m sure there are other ways to handle this that I haven’t discovered yet.</p><h2 id="clean-up"><span class="me-2">Clean Up</span><a href="#clean-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Delete all the deployments and services:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>kubectl delete deployment app1 app2 app3 app4
kubectl delete service app1-service app2-service app3-service app4-service
kubectl delete configmap app1-html app2-html app3-html
</pre></table></code></div></div><p>(Note: If you’re cleaning up after the LoadBalancer example earlier, you’ll only have app1, app2, and their ConfigMaps.)</p><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>deployment.apps "app1" deleted
deployment.apps "app2" deleted
deployment.apps "app3" deleted
deployment.apps "app4" deleted
service "app1-service" deleted
service "app2-service" deleted
service "app3-service" deleted
service "app4-service" deleted
configmap "app1-html" deleted
configmap "app2-html" deleted
configmap "app3-html" deleted
</pre></table></code></div></div><p>Remove the YAML files:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">rm</span> <span class="nt">-f</span> app1-deployment.yaml app2-deployment.yaml app1-nodeport.yaml app2-nodeport.yaml app3-nodeport.yaml
</pre></table></code></div></div><p>If you want to keep the cluster for future experiments, leave it running. Otherwise, delete it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>k3d cluster delete learning
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>INFO[0000] Deleting cluster 'learning'                  
INFO[0001] Cluster 'learning' deleted successfully!
</pre></table></code></div></div><h2 id="what-you-learned"><span class="me-2">What You Learned</span><a href="#what-you-learned" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>✅ Port mapping in k3d isn’t automatic—you set it up when creating the cluster<br /> ✅ LoadBalancer in k3d requires Ingress resources to route traffic (we’ll cover this in a future post)<br /> ✅ <code class="language-plaintext highlighter-rouge">kubectl port-forward</code> is different from LoadBalancer—it creates a direct tunnel bypassing all cluster networking<br /> ✅ NodePort gives you direct port-to-service mappings without needing Ingress configuration<br /> ✅ You need to plan your port mappings ahead of time with k3d<br /> ✅ ConfigMaps can serve custom HTML content from volumes<br /> ✅ Multiple services can run on different localhost ports with the right setup</p><p>What I found is that for local k3d development, NodePort with explicit port mappings gave me the control and predictability I needed. I know exactly which localhost port goes to which service, with no surprises and no extra configuration. Your mileage may vary depending on your setup and requirements.</p><h2 id="whats-next"><span class="me-2">What’s Next?</span><a href="#whats-next" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In <strong>Part 5</strong> of this series, we’ll explore <strong>Persistent Storage</strong> in Kubernetes. You’ll learn how to:</p><ul><li>Use volumes to persist data beyond pod lifecycles<li>Work with Persistent Volumes and Persistent Volume Claims<li>Deploy stateful applications that need to keep data</ul><p>Stay tuned!</p><hr /><h2 id="series-navigation"><span class="me-2">Series Navigation</span><a href="#series-navigation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><strong>Part 1:</strong> <a href="/posts/kubernetes-learning-path-deploy-your-first-app/">Deploy Your First App</a><br /> <strong>Part 2:</strong> <a href="/posts/kubernetes-learning-path-configmaps-and-secrets/">ConfigMaps and Secrets</a><br /> <strong>Part 3:</strong> <a href="/posts/kubernetes-learning-path-namespaces/">Understanding Namespaces</a><br /> <strong>Part 4:</strong> Understanding Port Mapping in k3d ← You just finished this!<br /> <strong>Part 5:</strong> Persistent Storage (Coming soon)</p><hr /><p>Found a mistake or have questions? Feel free to <a href="https://github.com/shairyar/shairyar.github.io/issues/new">open an issue here</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/kubernetes/">Kubernetes</a>, <a href="/categories/tutorial/">Tutorial</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/k3d/" class="post-tag no-text-decoration" >k3d</a> <a href="/tags/port-mapping/" class="post-tag no-text-decoration" >port-mapping</a> <a href="/tags/nodeport/" class="post-tag no-text-decoration" >nodeport</a> <a href="/tags/loadbalancer/" class="post-tag no-text-decoration" >loadbalancer</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> Thanks for reading! Feel free to share this post with others.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Kubernetes%20Learning%20Path:%20Understanding%20Port%20Mapping%20in%20k3d%20-%20Shairyar%20Baig&url=https%3A%2F%2Fshairyar.github.io%2Fposts%2Fkubernetes-learning-path-port-mapping%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Kubernetes%20Learning%20Path:%20Understanding%20Port%20Mapping%20in%20k3d%20-%20Shairyar%20Baig&u=https%3A%2F%2Fshairyar.github.io%2Fposts%2Fkubernetes-learning-path-port-mapping%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fshairyar.github.io%2Fposts%2Fkubernetes-learning-path-port-mapping%2F&text=Kubernetes%20Learning%20Path:%20Understanding%20Port%20Mapping%20in%20k3d%20-%20Shairyar%20Baig" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/kubernetes-learning-path-persistent-storage/">Kubernetes Learning Path: Understanding Persistent Storage</a><li class="text-truncate lh-lg"> <a href="/posts/remote-access-to-k3s-homelab-with-tailscale/">Remote Access to Your k3s Homelab with Tailscale</a><li class="text-truncate lh-lg"> <a href="/posts/kubernetes-learning-path-rails-solidqueue-on-k3s/">Kubernetes Learning Path: Deploying Rails 8 with SolidQueue on Raspberry Pi k3s</a><li class="text-truncate lh-lg"> <a href="/posts/kubernetes-learning-path-ingress-controller/">Kubernetes Learning Path: Setting Up Ingress Controller for External Access</a><li class="text-truncate lh-lg"> <a href="/posts/kubernetes-learning-path-k3s-on-raspberry-pi/">Kubernetes Learning Path: Setting Up k3s on Raspberry Pi</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/k3d/">k3d</a> <a class="post-tag btn btn-outline-primary" href="/tags/k3s/">k3s</a> <a class="post-tag btn btn-outline-primary" href="/tags/deployment/">deployment</a> <a class="post-tag btn btn-outline-primary" href="/tags/raspberry-pi/">raspberry-pi</a> <a class="post-tag btn btn-outline-primary" href="/tags/configmap/">configmap</a> <a class="post-tag btn btn-outline-primary" href="/tags/networking/">networking</a> <a class="post-tag btn btn-outline-primary" href="/tags/postgresql/">postgresql</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby-on-rails/">ruby-on-rails</a> <a class="post-tag btn btn-outline-primary" href="/tags/docker/">docker</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/kubernetes-learning-path-namespaces/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1760936400" data-df="ll" > Oct 20, 2025 </time><h4 class="pt-0 my-2">Kubernetes Learning Path: Understanding Namespaces</h4><div class="text-muted"><p>Kubernetes Learning Path: Understanding Namespaces In the previous posts, we’ve deployed apps and managed configuration. But what happens when you want to run multiple environments on the same clu...</p></div></div></a></article><article class="col"> <a href="/posts/kubernetes-learning-path-configmaps-and-secrets/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1760850000" data-df="ll" > Oct 19, 2025 </time><h4 class="pt-0 my-2">Kubernetes Learning Path: ConfigMaps and Secrets</h4><div class="text-muted"><p>Kubernetes Learning Path: ConfigMaps and Secrets In the previous post, we deployed our first application to Kubernetes. But here’s the thing—real applications need configuration. Database URLs, AP...</p></div></div></a></article><article class="col"> <a href="/posts/kubernetes-learning-path-deploy-your-first-app/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1760698800" data-df="ll" > Oct 17, 2025 </time><h4 class="pt-0 my-2">Kubernetes Learning Path: Deploy Your First App</h4><div class="text-muted"><p>Kubernetes Learning Path: Deploy Your First App I have been wanting to learn Kubernetes for a while now, and I came across a tool called k3d. It is a great tool that makes it easy to run Kubernete...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/kubernetes-learning-path-namespaces/" class="btn btn-outline-primary" aria-label="Older" ><p>Kubernetes Learning Path: Understanding Namespaces</p></a> <a href="/posts/kubernetes-learning-path-k3s-on-raspberry-pi/" class="btn btn-outline-primary" aria-label="Newer" ><p>Kubernetes Learning Path: Setting Up k3s on Raspberry Pi</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/iamshairyar">Shairyar Baig</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.3.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/k3d/">k3d</a> <a class="post-tag btn btn-outline-primary" href="/tags/k3s/">k3s</a> <a class="post-tag btn btn-outline-primary" href="/tags/deployment/">deployment</a> <a class="post-tag btn btn-outline-primary" href="/tags/raspberry-pi/">raspberry-pi</a> <a class="post-tag btn btn-outline-primary" href="/tags/configmap/">configmap</a> <a class="post-tag btn btn-outline-primary" href="/tags/networking/">networking</a> <a class="post-tag btn btn-outline-primary" href="/tags/postgresql/">postgresql</a> <a class="post-tag btn btn-outline-primary" href="/tags/ruby-on-rails/">ruby-on-rails</a> <a class="post-tag btn btn-outline-primary" href="/tags/docker/">docker</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
